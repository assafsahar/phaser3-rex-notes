!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.rexbbcodetext=e():t.rexbbcodetext=e()}(window,function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=260)}({1:function(t,e,i){"use strict";e.a={hleft:0,hcenter:1,hright:2,vtop:0,vcenter:1,vbottom:2,NO_NEWLINE:0,RAW_NEWLINE:1,WRAPPED_NEWLINE:2,NO_WRAP:0,WORD_WRAP:1,CHAR_WRAP:2,SPLITREGEXP:/(?:\r\n|\r|\n)/}},10:function(t,e,i){"use strict";var s=i(7);e.a=function(t,e){var i=Array.isArray(t);for(var n in void 0===e?e=i?[]:{}:Object(s.a)(e),i&&(e.length=t.length),t)e[n]=t[n];return e}},11:function(t,e,i){"use strict";var s=class{constructor(){this.items=[]}pop(){return this.items.length>0?this.items.pop():null}push(t){this.items.push(t)}pushMultiple(t){for(var e=0,i=t.length;e<i;e++)this.items.push(t[e]);t.length=0}};e.a=s},12:function(t,e,i){"use strict";i.r(e);e.default=function(){}},134:function(t,e){var i=Phaser.Renderer.WebGL.Utils;t.exports=function(t,e,s,n,r){if(0!==e.width&&0!==e.height){var a=e.frame,o=a.width,h=a.height,l=i.getTintAppendFloatAlpha;this.pipeline.batchTexture(e,a.glTexture,o,h,e.x,e.y,o/e.style.resolution,h/e.style.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,o,h,l(e._tintTL,n.alpha*e._alphaTL),l(e._tintTR,n.alpha*e._alphaTR),l(e._tintBL,n.alpha*e._alphaBL),l(e._tintBR,n.alpha*e._alphaBR),e._isTinted&&e.tintFill,0,0,n,r)}}},135:function(t,e){t.exports=function(t,e,i,s,n){0!==e.width&&0!==e.height&&t.batchSprite(e,e.frame,s,n)}},160:function(t,e,i){"use strict";var s=i(54);e.a=function(t,e,i,n){var r=new s.a(this.scene,t,e,i,n);return this.scene.add.existing(r),r}},161:function(t,e,i){"use strict";var s=i(54);const n=Phaser.Utils.Objects.GetAdvancedValue,r=Phaser.GameObjects.BuildGameObject;e.a=function(t,e){var i=n(t,"text",""),a=n(t,"style",null),o=n(t,"padding",null);null!==o&&(a.padding=o),void 0!==e&&(t.add=e);var h=new s.a(this.scene,0,0,i,a);return r(this.scene,h,t),h.autoRound=n(t,"autoRound",!0),h.resolution=n(t,"resolution",1),h}},260:function(t,e,i){"use strict";i.r(e);var s=i(160),n=i(161),r=i(54);Phaser.GameObjects.GameObjectFactory.register("rexBBCodeText",s.a),Phaser.GameObjects.GameObjectCreator.register("rexBBCodeText",n.a),e.default=r.a},33:function(t,e,i){"use strict";const s=Phaser.Display.Canvas.CanvasPool;var n={},r=function(t){var e=s.create(this),i=e.getContext("2d");t.syncFont(e,i);var r=Math.ceil(i.measureText(t.testString).width*t.baselineX),a=r,o=2*a;a=a*t.baselineY|0,e.width=r,e.height=o,i.fillStyle="#f00",i.fillRect(0,0,r,o),i.font=t._font,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(t.testString,0,a);var h=n;if(!i.getImageData(0,0,r,o))return h.ascent=a,h.descent=a+6,h.fontSize=h.ascent+h.descent,s.remove(e),h;var l,d,u=i.getImageData(0,0,r,o).data,c=u.length,f=4*r,g=0,p=!1;for(l=0;l<a;l++){for(d=0;d<f;d+=4)if(255!==u[g+d]){p=!0;break}if(p)break;g+=f}for(h.ascent=a-l,g=c-f,p=!1,l=o;l>a;l--){for(d=0;d<f;d+=4)if(255!==u[g+d]){p=!0;break}if(p)break;g-=f}return h.descent=l-a,h.fontSize=h.ascent+h.descent,s.remove(e),h},a=i(1);const o=Phaser.Utils.Objects.GetAdvancedValue,h=Phaser.Utils.Objects.GetValue;var l={backgroundColor:["backgroundColor",null],fontFamily:["fontFamily","Courier"],fontSize:["fontSize","16px"],fontStyle:["fontStyle",""],color:["color","#fff"],stroke:["stroke","#fff"],strokeThickness:["strokeThickness",0],shadowOffsetX:["shadow.offsetX",0],shadowOffsetY:["shadow.offsetY",0],shadowColor:["shadow.color","#000"],shadowBlur:["shadow.blur",0],shadowStroke:["shadow.stroke",!1],shadowFill:["shadow.fill",!1],underlineColor:["underline.color","#000"],underlineThickness:["underline.thickness",0],underlineOffset:["underline.offset",0],halign:["halign",0],valign:["valign",0],maxLines:["maxLines",0],fixedWidth:["fixedWidth",0],fixedHeight:["fixedHeight",0],resolution:["resolution",0],lineSpacing:["lineSpacing",0],rtl:["rtl",!1],testString:["testString","|MÃ‰qgy"],baselineX:["baselineX",1.2],baselineY:["baselineY",1.4],wrapMode:["wrap.mode",1],wrapWidth:["wrap.width",0]};const d={left:a.a.hleft,center:a.a.hcenter,right:a.a.hright},u={top:a.a.vtop,center:a.a.vcenter,bottom:a.a.vbottom},c={none:a.a.NO_WRAP,word:a.a.WORD_WRAP,char:a.a.CHAR_WRAP,character:a.a.CHAR_WRAP};e.a=class{constructor(t,e){this.parent=t,this.backgroundColor,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.lineSpacing,this.rtl,this.testString,this.baselineX,this.baselineY,this._font,this.setStyle(e,!1);var i=h(e,"metrics",!1);this.metrics=i?{ascent:h(i,"ascent",0),descent:h(i,"descent",0),fontSize:h(i,"fontSize",0)}:r(this)}setStyle(t,e){if(void 0===e&&(e=!0),t&&t.hasOwnProperty("halign")&&"string"==typeof t.halign&&(t.halign=d[t.halign.toLowerCase()]||0),t&&t.hasOwnProperty("valign")&&"string"==typeof t.valign&&(t.valign=u[t.valign.toLowerCase()]||0),t&&t.hasOwnProperty("wrap")){var i=t.wrap;if(i.hasOwnProperty("mode")){var s=i.mode;"string"==typeof s&&(i.mode=c[s])}else i.hasOwnProperty("width")&&(i.mode=1)}for(var n in t&&t.hasOwnProperty("fontSize")&&"number"==typeof t.fontSize&&(t.fontSize=t.fontSize.toString()+"px"),l)this[n]="wrapCallback"===n||"wrapCallbackScope"===n?h(t,l[n][0],l[n][1]):o(t,l[n][0],l[n][1]);var r=h(t,"font",null);this._font=null===r?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:r;var a=h(t,"fill",null);return null!==a&&(this.color=a),e?this.update(!0):this.parent}syncFont(t,e){e.font=this._font}syncStyle(t,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round"}syncShadow(t,e){e?(t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=0,t.shadowBlur=0)}update(t){return t&&(this._font=this.fontStyle+" "+this.fontSize+" "+this.fontFamily,this.metrics=r(this)),this.parent.updateText(t)}buildFont(){var t=this.fontStyle+" "+this.fontSize+" "+this.fontFamily;return t!==this._font&&(this._font=t),this}setFont(t){return"string"==typeof t?(this.fontFamily=t,this.fontSize="",this.fontStyle=""):(this.fontFamily=h(t,"fontFamily","Courier"),this.fontSize=h(t,"fontSize","16px"),this.fontStyle=h(t,"fontStyle","")),this.update(!0)}setFontFamily(t){return this.fontFamily=t,this.update(!0)}setFontStyle(t){return this.fontStyle=t,this.update(!0)}setFontSize(t){return"number"==typeof t&&(t=t.toString()+"px"),this.fontSize=t,this.update(!0)}setTestString(t){return this.testString=t,this.update(!0)}setFixedSize(t,e){return this.fixedWidth=t,this.fixedHeight=e,t&&(this.parent.width=t),e&&(this.parent.height=e),this.update(!1)}setResolution(t){return this.resolution=t,this.update(!1)}setLineSpacing(t){return this.lineSpacing=t,this.update(!1)}setBackgroundColor(t){return this.backgroundColor=t,this.update(!1)}setFill(t){return this.color=t,this.update(!1)}setColor(t){return this.color=t,this.update(!1)}setStroke(t,e){return void 0===t?this.strokeThickness=0:(void 0===e&&(e=this.strokeThickness),this.stroke=t,this.strokeThickness=e),this.update(!0)}setShadow(t,e,i,s,n,r){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i="#000"),void 0===s&&(s=0),void 0===n&&(n=!1),void 0===r&&(r=!0),this.shadowOffsetX=t,this.shadowOffsetY=e,this.shadowColor=i,this.shadowBlur=s,this.shadowStroke=n,this.shadowFill=r,this.update(!1)}setShadowOffset(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.shadowOffsetX=t,this.shadowOffsetY=e,this.update(!1)}setShadowColor(t){return void 0===t&&(t="#000"),this.shadowColor=t,this.update(!1)}setShadowBlur(t){return void 0===t&&(t=0),this.shadowBlur=t,this.update(!1)}setShadowStroke(t){return this.shadowStroke=t,this.update(!1)}setShadowFill(t){return this.shadowFill=t,this.update(!1)}setUnderline(t,e,i){return void 0===t&&(t="#000"),void 0===e&&(e=0),void 0===i&&(i=0),this.underlineColor=t,this.underlineThickness=e,this.underlineOffset=i,this.update(!1)}setUnderlineColor(t){return void 0===t&&(t="#000"),this.underlineColor=t,this.update(!1)}setUnderlineThickness(t){return void 0===t&&(t=0),this.underlineThickness=t,this.update(!1)}setUnderlineOffset(t){return void 0===t&&(t=0),this.underlineOffset=t,this.update(!1)}setWrapMode(t){return"string"==typeof t&&(t=c[t.toLowerCase()]||0),this.wrapMode=t,this.update(!0)}setWrapWidth(t){return this.wrapWidth=t,this.update(!1)}setAlign(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),"string"==typeof t&&(t=d[t.toLowerCase()]||0),"string"==typeof e&&(e=d[e.toLowerCase()]||0),this.halign=t,this.valign=e,this.update(!1)}setHAlign(t){return void 0===t&&(t=0),"string"==typeof t&&(t=d[t.toLowerCase()]||0),this.halign=t,this.update(!1)}setVAlign(t){return void 0===t&&(t=0),"string"==typeof t&&(t=d[t.toLowerCase()]||0),this.valign=t,this.update(!1)}setMaxLines(t){return void 0===t&&(t=0),this.maxLines=t,this.update(!1)}getTextMetrics(){var t=this.metrics;return{ascent:t.ascent,descent:t.descent,fontSize:t.fontSize}}get lineHeight(){return this.metrics.fontSize+this.strokeThickness+this.lineSpacing}toJSON(){var t={};for(var e in l)t[e]=this[e];return t.metrics=this.getTextMetrics(),t}destroy(){this.parent=void 0}}},54:function(t,e,i){"use strict";var s=i(57),n={plainText:null,prevProp:null},r=new(i(33).a),a={},o={splitText:function(t,e){for(var i,s,n=[],r=0,a=t.length,o=a;i=d.exec(t);)s=i[0],r<(o=d.lastIndex-s.length)&&n.push(t.substring(r,o)),void 0===e&&n.push(s),r=d.lastIndex;return r<a&&n.push(t.substring(r,a)),n},tagTextToProp:function(t,e){var i,s;null==e&&(e={}),e.img&&h(e,F,"img"),u.test(t)?(h(e,_,"b",!0),i=""):c.test(t)?(h(e,F,"b"),i=""):f.test(t)?(h(e,_,"i",!0),i=""):g.test(t)?(h(e,F,"i"),i=""):p.test(t)?(s=t.match(p),h(e,_,"size",s[1]+"px"),i=""):v.test(t)?(h(e,F,"size"),i=""):x.test(t)?(s=t.match(x),h(e,_,"color",s[1]),i=""):w.test(t)?(h(e,F,"color"),i=""):y.test(t)?(s=t.match(y),h(e,_,"u",!0),i=""):m.test(t)?(s=t.match(m),h(e,_,"u",s[1]),i=""):T.test(t)?(h(e,F,"u"),i=""):S.test(t)?(h(e,_,"shadow",!0),i=""):P.test(t)?(h(e,F,"shadow"),i=""):O.test(t)?(h(e,_,"stroke",!0),i=""):M.test(t)?(s=t.match(M),h(e,_,"stroke",s[1]),i=""):k.test(t)?(h(e,F,"stroke"),i=""):b.test(t)?(s=t.match(b),h(e,_,"img",s[1]),i=""):L.test(t)?(h(e,F,"img"),i=""):W.test(t)?(s=t.match(W),h(e,_,"area",s[1]),i=""):C.test(t)?(h(e,F,"area"),i=""):i=t;var r=n;return r.plainText=i,r.prop=e,r},propToContextStyle:function(t,e){var i=r;if(e.hasOwnProperty("img"))i.image=e.img;else{if(i.image=null,e.hasOwnProperty("family")?i.fontFamily=e.family:i.fontFamily=t.fontFamily,e.hasOwnProperty("size")){var s=e.size;"number"==typeof s&&(s=s.toString()+"px"),i.fontSize=s}else i.fontSize=t.fontSize;i.fontStyle=l(e.b,e.i),e.hasOwnProperty("color")?i.color=e.color:i.color=t.color,e.hasOwnProperty("stroke")?!0===e.stroke?(i.stroke=t.stroke,i.strokeThickness=t.strokeThickness):(i.stroke=e.stroke,i.strokeThickness=t.strokeThickness):(i.stroke=t.stroke,i.strokeThickness=0)}return e.hasOwnProperty("shadow")?!0===e.shadow?(i.shadowColor=t.shadowColor,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0):(i.shadowColor=e.shadow,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0):(i.shadowColor="#000",i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=0,i.shadowStroke=!1,i.shadowFill=!1),e.hasOwnProperty("u")?!0===e.u?(i.underlineColor=t.underlineColor,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset):(i.underlineColor=e.u,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset):(i.underlineColor="#000",i.underlineThickness=0,i.underlineOffset=0),i},propToTagText:function(t,e,i){for(var s in null==i&&(i=a),i)e.hasOwnProperty(s)||(t="[/"+s+"]"+t);var n="";for(var s in e)i[s]!==e[s]&&("size"===s?n+="[size="+e[s].replace("px","")+"]":"color"===s||"stroke"===s||"img"===s?n+="["+s+"="+e[s]+"]":"u"===s?!0===e[s]?n+="[u]":n+="[u="+e[s]+"]":n+="["+s+"]");return t=n+t}},h=function(t,e,i,s){return e===_?t[i]=s:t.hasOwnProperty(i)&&delete t[i],t},l=function(t,e){return t&&e?"bold italic":t?"bold":e?"italic":""},d=/\[b\]|\[\/b\]|\[i\]|\[\/i\]|\[size=(\d+)\]|\[\/size\]|\[color=([a-z]+|#[0-9abcdef]+)\]|\[\/color\]|\[u\]|\[u=([a-z]+|#[0-9abcdef]+)\]|\[\/u\]|\[shadow\]|\[\/shadow\]|\[stroke\]|\[stroke=([a-z]+|#[0-9abcdef]+)\]|\[\/stroke\]|\[img=([^\]]+)\]|\[\/img\]|\[area=([^\]]+)\]|\[\/area\]/gi,u=/\[b\]/i,c=/\[\/b\]/i,f=/\[i\]/i,g=/\[\/i\]/i,p=/\[size=(\d+)\]/i,v=/\[\/size\]/i,x=/\[color=([a-z]+|#[0-9abcdef]+)\]/i,w=/\[\/color\]/i,y=/\[u\]/i,m=/\[u=([a-z]+|#[0-9abcdef]+)\]/i,T=/\[\/u\]/i,S=/\[shadow\]/i,P=/\[\/shadow\]/i,O=/\[stroke\]/i,M=/\[stroke=([a-z]+|#[0-9abcdef]+)\]/i,k=/\[\/stroke\]/i,b=/\[img=([^\]]+)\]/i,L=/\[\/img\]/i,W=/\[area=([^\]]+)\]/i,C=/\[\/area\]/i;const F=!1,_=!0;var A=o;e.a=class extends s.a{constructor(t,e,i,s,n){super(t,e,i,s,n,"rexBBCodeText",A)}}},57:function(t,e,i){"use strict";var s=i(71),n=i.n(s),r=i(33),a=i(1);a.a.hleft;const o=a.a.hcenter,h=a.a.hright,l=(a.a.vtop,a.a.vcenter),d=a.a.vbottom;var u={draw(t,e,i,s){var n=this.penManager;this.hitAreaManager.clear();var r=this.context;r.save(),this.drawBackground(this.defatultStyle.backgroundColor);var a=this.defatultStyle;t+=this.startXOffset,e+=this.startYOffset;var u,c,f,g,p,v,x=a.halign,w=a.valign,y=a.lineHeight,m=n.lines,T=m.length,S=a.maxLines;S>0&&T>S?(c=S,f=w===l?Math.floor((T-c)/2):w===d?T-c:0):(c=T,f=0),g=f+c,v=w===l?Math.max((s-c*y)/2,0):w===d?Math.max(s-c*y-2,0):0,v+=e;for(var P=f;P<g;P++)if(0!==(u=n.getLineWidth(P))){p=x===o?(i-u)/2:x===h?i-u:0,p+=t;for(var O=m[P],M=0,k=O.length;M<k;M++)this.drawPen(O[M],p,v)}r.restore()},drawPen(t,e,i){e+=t.x,i+=t.y;var s=this.canvas,n=this.context;n.save();var r=this.parser.propToContextStyle(this.defatultStyle,t.prop);r.buildFont(),r.syncFont(s,n),r.syncStyle(s,n),r.underlineThickness>0&&t.width>0&&this.drawUnderline(e,i,t.width,r),t.isTextPen&&this.drawText(e,i,t.text,r),t.isImagePen&&this.drawImage(e,i,t.prop.img,r),n.restore(),t.hasAreaMarker&&t.width>0&&this.hitAreaManager.add(t.prop.area,e,i-this.startYOffset,t.width,this.defatultStyle.lineHeight)},clear(){var t=this.canvas;this.context.clearRect(0,0,t.width,t.height)},drawBackground(t){null!==t&&(this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height))},drawUnderline(t,e,i,s){e+=s.underlineOffset-s.underlineThickness/2,this.autoRound&&(t=Math.round(t),e=Math.round(e));var n=this.context,r=n.lineCap;n.lineCap="butt",n.beginPath(),n.strokeStyle=s.underlineColor,n.lineWidth=s.underlineThickness,n.moveTo(t,e),n.lineTo(t+i,e),n.stroke(),n.lineCap=r},drawText(t,e,i,s){this.autoRound&&(t=Math.round(t),e=Math.round(e));var n=this.context;s.strokeThickness&&(s.syncShadow(n,s.shadowStroke),n.strokeText(i,t,e)),s.color&&"none"!==s.color&&(s.syncShadow(n,s.shadowFill),n.fillText(i,t,e))},drawImage(t,e,i,s){var n=this.parent.imageManager,r=n.get(i),a=n.getFrame(i);t+=r.left,e+=-this.startYOffset+r.y,this.autoRound&&(t=Math.round(t),e=Math.round(e)),this.context.drawImage(a.source.image,a.cutX,a.cutY,a.cutWidth,a.cutHeight,t,e,r.width,r.height)}},c=i(11);const f=Phaser.Utils.Objects.GetValue,g=a.a.NO_NEWLINE,p=a.a.RAW_NEWLINE;var v=class{constructor(t){this.prop={},this.resetFromJSON(t)}resetFromJSON(t){this.text=f(t,"text",""),this.x=f(t,"x",0),this.y=f(t,"y",0),this.width=f(t,"width",0);var e=f(t,"prop",null);null===e&&(e={}),this.prop=e,this.newLineMode=f(t,"newLineMode",0),this.startIndex=f(t,"startIndex",0)}get plainText(){var t=this.text;return this.newLineMode===p&&(t+="\n"),t}get wrapText(){var t=this.text;return this.newLineMode!==g&&(t+="\n"),t}get rawTextLength(){var t=this.text.length;return this.newLineMode===p&&(t+=1),t}get endIndex(){return this.startIndex+this.rawTextLength}get lastX(){return this.x+this.width}get isTextPen(){return""!==this.text}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}},x=i(10),w=i(12);const y=Phaser.Utils.Objects.GetFastValue,m=a.a.NO_NEWLINE,T=a.a.WRAPPED_NEWLINE;var S=new c.a,P=new c.a;class O{constructor(t){this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.PensPool=y(t,"pensPool",S),this.LinesPool=y(t,"linesPool",P),this.tagToText=y(t,"tagToText",w.default),this.tagToTextScope=y(t,"tagToTextScope",void 0)}destroy(){this.freePens(),this.tagToText=void 0,this.tagToTextScope=void 0}freePens(){for(var t=0,e=this.lines.length;t<e;t++)this.lines[t].length=0;this.PensPool.pushMultiple(this.pens),this.LinesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}addTextPen(t,e,i,s,n,r){var a=this.PensPool.pop();return null==a&&(a=new v),M.text=t,M.x=e,M.y=i,M.width=s,M.prop=n,M.newLineMode=r,a.resetFromJSON(M),this.addPen(a),this}addImagePen(t,e,i,s){return this.addTextPen("",t,e,i,s,m),this}addNewLinePen(){var t=this.lastPen,e=t?t.lastX:0,i=t?t.y:0,s=t?Object(x.a)(t.prop):null;return this.addTextPen("",e,i,0,s,T),this}addPen(t){var e=this.lastPen;t.startIndex=null==e?0:e.endIndex,this.pens.push(t);var i=this.lastLine;null==i&&(i=this.LinesPool.pop()||[],this.lines.push(i)),i.push(t),t.newLineMode!==m&&(i=this.LinesPool.pop()||[],this.lines.push(i)),this.maxLinesWidth=void 0}clone(t){null==t&&(t=new O),t.freePens();for(var e=0,i=this.lines.length;e<i;e++)for(var s=this.lines[e],n=0,r=s.length;n<r;n++){var a=s[n];t.addPen(a.text,a.x,a.y,a.width,Object(x.a)(a.prop),a.newLineMode)}return t}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(t){if(t>=this.lines.length)return this.getLineEndIndex(t);var e=this.lines[t];return e&&e[0]?e[0].startIndex:0}getLineEndIndex(t){t>=this.lines.length&&(t=this.lines.length-1);var e,i,s=!1;for(e=t;e>=0&&!(s=null!=(i=this.lines[e])&&i.length>0);e--);return s?i[i.length-1].endIndex:0}getLineWidth(t){var e=this.lines[t];if(!e)return 0;var i=e[e.length-1];return null==i?0:i.lastX}getMaxLineWidth(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var t,e=0,i=0,s=this.lines.length;i<s;i++)(t=this.getLineWidth(i))>e&&(e=t);return this.maxLinesWidth=e,e}getLineWidths(){for(var t=[],e=0,i=this.lines.length;e<i;e++)t.push(this.getLineWidth(e));return t}get linesCount(){return this.lines.length}get plainText(){for(var t="",e=this.pens,i=0,s=e.length;i<s;i++)t+=e[i].plainText;return t}get rawTextLength(){for(var t=0,e=this.pens,i=0,s=this.pens.length;i<s;i++)t+=e[i].rawTextLength;return t}getSliceTagText(t,e,i){if(void 0===t&&(t=0),void 0===e){var s=this.lastPen;if(null==s)return"";e=s.endIndex}void 0===i&&(i=!1);for(var n,r,a,o,h,l,d="",u=0,c=this.pens.length;u<c&&((o=(n=this.pens[u]).endIndex)<=t||(n=this.pens[u],r=i?n.wrapText:n.plainText,h=n.prop,(a=n.startIndex)>=t&&o<=e||(r=r.substring(t-a,e-a)),this.tagToTextScope?d+=this.tagToText.call(this.tagToTextScope,r,h,l):d+=this.tagToText(r,h,l),l=h,!(o>=e)));u++);return d}}var M={},k=O;const b=Phaser.Geom.Rectangle;var L=new c.a;var W=class{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return L.pushMultiple(this.hitAreas),this}add(t,e,i,s,n){var r=L.pop();return null===r?r=new b(e,i,s,n):r.setTo(e,i,s,n),r.key=t,this.hitAreas.push(r),this}contains(t,e){for(var i,s=this.hitAreas,n=0,r=s.length;n<r;n++)if((i=s[n]).contains(t,e))return i.key;return!1}drawBounds(t,e,i){void 0===e&&(e=16777215),i&&t.save().scaleCanvas(i.scaleX,i.scaleY).rotateCanvas(i.rotation).translateCanvas(i.x,i.y);for(var s,n=this.hitAreas,r=0,a=n.length;r<a;r++)s=n[r],t.lineStyle(1,e).strokeRect(s.x,s.y,s.width,s.height);return i&&t.restore(),this}},C=function(t,e,i,s){var n=this.hitAreaManager.contains(i,s);!1!==n&&(this.parent.emit(`${t}-${n}`,e,i,s),this.parent.emit(t,n,e,i,s))},F=function(){this.parent.on("pointerdown",function(t,e,i,s){C.call(this,"areadown",t,e,i)},this).on("pointerup",function(t,e,i,s){C.call(this,"areaup",t,e,i)},this)};const _=a.a.NO_NEWLINE,A=a.a.RAW_NEWLINE,z=a.a.WRAPPED_NEWLINE,R=a.a.NO_WRAP,I=a.a.WORD_WRAP,N=(a.a.CHAR_WRAP,a.a.SPLITREGEXP);var B=[],j=new c.a;j.newline=function(t,e,i){var s=this.pop();return null===s&&(s={}),s.text=t,s.width=e,s.newLineMode=i,s};var E=function(t,e,i,s,n){s<=0&&(i=R);var r=B;if(j.pushMultiple(r),!t||!t.length)return r;for(var a,o,h,l=t.split(N),d=0,u=l.length;d<u;d++)if(a=l[d],h=d===u-1?_:A,i!==R){var c,f;if(o=0===d?s-n:s,a.length<=100&&(m=e(a))<=o){r.push(j.newline(a,m,h));continue}for(var g,p="",v="",x=0,w=0,y=(c=i===I?a.split(" "):a).length;w<y;w++)f=c[w],i===I?(p+=f,w<y-1&&(p+=" ")):p+=f,(g=e(p))>o&&(0===w?r.push(j.newline("",0,z)):(r.push(j.newline(v,x,z)),p=f,i===I&&w<y-1&&(p+=" "),g=e(p)),o=s),v=p,x=g;r.push(j.newline(v,x,h))}else{var m=e(a);r.push(j.newline(a,m,h))}return r};const X=Phaser.Utils.Objects.GetValue,H=a.a.NO_WRAP,Y=a.a.NO_NEWLINE;class G{constructor(t){this.parent=t.parent,this.context=X(t,"context",null),this.canvas=this.context.canvas,this.parser=X(t,"parser",null),this.defatultStyle=X(t,"style",null),this.autoRound=!0,this.pensPool=X(t,"pensPool",null),this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new W;var e=this.context;this.getTextWidth=function(t){return e.measureText(t).width}}destroy(){this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defatultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0)}updatePenManager(t,e,i,s,n){if(void 0===n&&(n=this.penManager),n.freePens(),""===t)return n;for(var r,a,o,h,l,d=this.canvas,u=this.context,c=0,f=0,g=this.parser.splitText(t),p=0,v=g.length;p<v;p++)if(r=(h=this.parser.tagTextToProp(g[p],a)).plainText,(a=h.prop).img){var w=this.imageManager.getOuterWidth(a.img);i>0&&e!==H&&i<c+w&&(n.addNewLinePen(),f+=s,c=0),n.addImagePen(c,f,w,Object(x.a)(a)),c+=w}else if(""!==r){var y;this.context.save(),(o=this.parser.propToContextStyle(this.defatultStyle,a)).buildFont(),o.syncFont(d,u),o.syncStyle(d,u);for(var m=0,T=(l=E(r,this.getTextWidth,e,i,c)).length;m<T;m++)y=l[m],n.addTextPen(y.text,c,f,y.width,Object(x.a)(a),y.newLineMode),y.newLineMode!==Y?(c=0,f+=s):c+=y.width;this.context.restore()}return n}get startXOffset(){return this.defatultStyle.strokeThickness/2}get startYOffset(){var t=this.defatultStyle;return t.strokeThickness/2+t.metrics.ascent}get lines(){return this.penManager.lines}get desplayLinesCount(){var t=this.penManager.linesCount,e=this.defatultStyle.maxLines;return e>0&&t>e&&(t=e),t}get linesWidth(){return this.penManager.getMaxLineWidth()}get linesHeight(){var t=this.desplayLinesCount,e=this.defatultStyle.lineHeight*t;return t>0&&(e-=this.defatultStyle.lineSpacing),e}get imageManager(){return this.parent.imageManager}newPenManager(){return new k({pensPool:this.pensPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}get tmpPenManager(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}getPlainText(t,e,i){var s;if(null==t)s=this.penManager.plainText;else{var n=this.parser.splitText(t,1);s="";for(var r=0,a=n.length;r<a;r++)s+=n[r]}return null==e&&null==i||(null==e&&(e=0),null==i&&(i=s.length),s=s.substring(e,i)),s}getPenManager(t,e){if(void 0===t)return this.copyPenManager(e,this.penManager);void 0===e&&(e=this.newPenManager());var i=this.defatultStyle;return this.updatePenManager(t,i.wrapMode,i.wrapWidth,i.lineHeight,e),e}getText(t,e,i,s){if(null==t)return this.penManager.getSliceTagText(e,i,s);var n=this.tmpPenManager,r=this.defatultStyle;return this.updatePenManager(t,r.wrapMode,r.wrapWidth,r.lineHeight,n),n.getSliceTagText(e,i,s)}copyPenManager(t,e){return void 0===e&&(e=this.penManager),e.copy(t)}getTextWidth(t){return void 0===t&&(t=this.penManager),t.getMaxLineWidth()}getLastPen(t){return void 0===t&&(t=this.penManager),t.lastPen}}var D={setInteractive:F};Object.assign(G.prototype,u,D);var U=G;const V=Phaser.Utils.Objects.GetValue;var J,$=class{constructor(t){this.textureManager=t,this.images={}}add(t,e){if("string"==typeof t)this._add(t,e);else if(Array.isArray(t))for(var i=0,s=(n=t).length;i<s;i++)this._add(n[i]);else{var n=t;for(var t in n)this._add(t,n[t])}return this}_add(t,e){void 0===e&&(e={key:t});var i=e.key,s=e.frame,n=e.width,r=e.height;if(void 0===n||void 0===r){var a=this.textureManager.getFrame(i,s),o=a?a.cutWidth:0,h=a?a.cutHeight:0;void 0===n&&void 0===r?(n=o,r=h):void 0===n?n=o*(r/h):void 0===r&&(r=h*(n/o))}this.images[t]={key:i,frame:s,width:n,height:r,y:V(e,"y",0),left:V(e,"left",0),right:V(e,"right",0)}}remove(t){return this.images.hasOwnProperty(t)&&delete this.images[t],this}get(t){return this.images.hasOwnProperty(t)||this.textureManager.exists(t)&&this.add(t),this.images[t]}getOuterWidth(t){var e=this.get(t);return e?e.width+e.left+e.right:0}getFrame(t){var e=this.get(t);return e?this.textureManager.getFrame(e.key,e.frame):void 0}hasTexture(t){return!!this.getFrame(t)}};const q=Phaser.DOM.AddToDOM,K=Phaser.Display.Canvas.CanvasPool,Q=Phaser.GameObjects.Components,Z=Phaser.GameObjects.GameObject,tt=Phaser.Utils.Objects.GetValue,et=Phaser.DOM.RemoveFromDOM,it=a.a.SPLITREGEXP;var st={},nt=new Phaser.Class({Extends:Z,Mixins:[Q.Alpha,Q.BlendMode,Q.ComputedSize,Q.Crop,Q.Depth,Q.Flip,Q.GetBounds,Q.Mask,Q.Origin,Q.Pipeline,Q.ScrollFactor,Q.Tint,Q.Transform,Q.Visible,n.a],initialize:function(t,e,i,s,n,a,o){if(void 0===e&&(e=0),void 0===i&&(i=0),Z.call(this,t,a),this.renderer=t.sys.game.renderer,this.setPosition(e,i),this.setOrigin(0,0),this.initPipeline(),this.canvas=K.create(this),this.context=this.canvas.getContext("2d"),n&&n.hasOwnProperty("align")){var h=n.align;delete n.align,n.halign=h}this.style=new r.a(this,n),this.autoRound=!0,this._text=void 0,this.padding={left:0,right:0,top:0,bottom:0},this.width=1,this.height=1,this.dirty=!1,0===this.style.resolution&&(this.style.resolution=t.sys.game.config.resolution),this._crop=this.resetCropObject(),this.texture=t.sys.textures.addCanvas(null,this.canvas,!0),this.frame=this.texture.get(),this.frame.source.resolution=this.style.resolution,this.renderer&&this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null),st.hasOwnProperty(a)||(st[a]=new c.a),this.canvasText=new U({parent:this,context:this.context,parser:o,style:this.style,pensPool:st[a]}),n&&n.padding&&this.setPadding(n.padding),this.setText(s),t.sys.game.config.renderType===Phaser.WEBGL&&t.sys.game.renderer.onContextRestored(function(){this.dirty=!0},this)},text:{set:function(t){this.setText(t)},get:function(){return this._text}},initRTL:function(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",q(this.canvas,this.scene.sys.canvas),this.originX=1)},setText:function(t){return t||0===t||(t=""),Array.isArray(t)&&(t=t.join("\n")),t!==this._text&&(this._text=t.toString(),this.updateText()),this},setStyle:function(t){return this.style.setStyle(t)},setFont:function(t){return this.style.setFont(t)},setFontFamily:function(t){return this.style.setFontFamily(t)},setFontSize:function(t){return this.style.setFontSize(t)},setFontStyle:function(t){return this.style.setFontStyle(t)},setFixedSize:function(t,e){return this.style.setFixedSize(t,e)},setBackgroundColor:function(t){return this.style.setBackgroundColor(t)},setFill:function(t){return this.style.setFill(t)},setColor:function(t){return this.style.setColor(t)},setStroke:function(t,e){return this.style.setStroke(t,e)},setShadow:function(t,e,i,s,n,r){return this.style.setShadow(t,e,i,s,n,r)},setShadowOffset:function(t,e){return this.style.setShadowOffset(t,e)},setShadowColor:function(t){return this.style.setShadowColor(t)},setShadowBlur:function(t){return this.style.setShadowBlur(t)},setShadowStroke:function(t){return this.style.setShadowStroke(t)},setShadowFill:function(t){return this.style.setShadowFill(t)},setWrapMode:function(t){return this.style.setWrapMode(t)},setWrapWidth:function(t){return this.style.setWrapWidth(t)},setAlign:function(t){return this.style.setHAlign(t)},setLineSpacing:function(t){return this.style.setLineSpacing(t)},setPadding:function(t,e,i,s){if("object"==typeof t){var n=t,r=tt(n,"x",null);null!==r?(t=r,i=r):(t=tt(n,"left",0),i=tt(n,"right",t));var a=tt(n,"y",null);null!==a?(e=a,s=a):(e=tt(n,"top",0),s=tt(n,"bottom",e))}else void 0===t&&(t=0),void 0===e&&(e=t),void 0===i&&(i=t),void 0===s&&(s=e);return this.padding.left=t,this.padding.top=e,this.padding.right=i,this.padding.bottom=s,this.updateText(!1)},setResolution:function(t){return this.style.setResolution(t)},setMaxLines:function(t){return this.style.setMaxLines(t)},updateText:function(t){void 0===t&&(t=!0);var e=this.canvasText,i=this.style;t&&e.updatePenManager(this._text,i.wrapMode,i.wrapWidth,i.lineHeight);var s,n,r=this.padding;0===i.fixedWidth?(this.width=e.linesWidth+r.left+r.right,s=e.linesWidth):(this.width=i.fixedWidth,(s=this.width-r.left-r.right)<e.linesWidth&&(s=e.linesWidth)),0===i.fixedHeight?(this.height=e.linesHeight+r.top+r.bottom,n=e.linesHeight):(this.height=i.fixedHeight,(n=this.height-r.top-r.bottom)<e.linesHeight&&(n=e.linesHeight));var a=this.width,o=this.height;this.updateDisplayOrigin();var h=i.resolution;a*=h,o*=h,a=Math.max(Math.ceil(a),1),o=Math.max(Math.ceil(o),1);var l=this.canvas,d=this.context;l.width!==a||l.height!==o?(l.width=a,l.height=o,this.frame.setSize(a,o)):d.clearRect(0,0,a,o),d.save(),d.scale(h,h),e.draw(r.left,r.top,s,n),d.restore(),this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(l,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!0;var u=this.input;return u&&!u.customHitArea&&(u.hitArea.width=this.width,u.hitArea.height=this.height),this},getTextMetrics:function(){return this.style.getTextMetrics()},toJSON:function(){var t=Q.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return t.data=e,t},preDestroy:function(){this.style.rtl&&et(this.canvas),K.remove(this.canvas),this.canvasText.destroy()},setInteractive:function(t,e,i){return Z.prototype.setInteractive.call(this,t,e,i),this.canvasText.setInteractive(),this},getWrappedText:function(t,e,i){return(t=this.canvasText.getText(t,e,i,!0)).split(it)},getPlainText:function(t,e,i){return this.canvasText.getPlainText(t,e,i)},getText:function(t,e,i){return this.canvasText.getText(t,e,i,!1)},getSubString:function(t,e,i){return this.getText(t,e,i)},copyPenManager:function(t){return this.canvasText.copyPenManager(t)},getPenManager:function(t,e){return this.canvasText.getPenManager(t,e)},setSize:function(t,e){return this.setFixedSize(t,e)},resize:function(t,e){return this.setFixedSize(t,e)},lineSpacing:{get:function(){return this.style.lineSpacing},set:function(t){this.setLineSpacing(t)}},imageManager:{get:function(){return t=this.scene.textures,void 0===J&&(J=new $(t)),J;var t}},addImage(t,e){return this.imageManager.add(t,e),this},drawAreaBounds(t,e){return this.canvasText.hitAreaManager.drawBounds(t,e,this),this}});e.a=nt},7:function(t,e,i){"use strict";e.a=function(t){if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e]}},71:function(t,e,i){var s=i(12),n=i(12);s=i(134),n=i(135),t.exports={renderWebGL:s,renderCanvas:n}}}).default});